<!DOCTYPE html>
<html lang="pt-br">
<head>
	<title>Teclado para CAA</title>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	
	<!-- Manifesto Json -->
	<link rel="manifest" href="./manifest.json">

	<script src="./index.js"></script>

	<!-- Cor tema -->
	<meta name="theme-color" content="#007bff">

	<!-- Descrição -->
	<meta name="description" content="Teclado para Comuicação Aumentativa e Alternativa, desenvolvido por CTA Bento Gonçalves">

	<link rel="icon" size="192x192" href="imagens/Icon10.png">
	<link rel="apple-touch-icon" href="imagens/Icon10.png">

	
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

	<!-- Font Awesome -->
	<script defer src="./fontawesome/js/brands.js"></script>
	<script defer src="./fontawesome/js/solid.js"></script>
	<script defer src="./fontawesome/js/fontawesome.js"></script>

	<link rel="stylesheet" type="text/css" href="estilo.css"/>

	
	
	<!-- Bootstrap -->
	<!-- jQuery primeiro, depois Popper.js, depois Bootstrap JS -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


	<script src="./varredura.js"></script>
	<script src="./layout.js"></script>

	<script>

		var lingua = "Brazilian Portuguese Female";
		var scan = null;
		var storageSpeedKey = "scan_interval";
		var interval = Number.parseInt(localStorage.getItem(storageSpeedKey)) || 1250; // milissegundos
		var minInterval = 500; 
		var maxInterval = 5000;

		function escreve(val) {
			document.getElementById("text").value += val.toUpperCase();
            var fala = new SpeechSynthesisUtterance(val);
            window.speechSynthesis.speak(fala);
		};

		function falar(texto) {
			var fala = new SpeechSynthesisUtterance(texto);
            window.speechSynthesis.speak(fala);
		}

		function erase() {
			falar("Apagar");
			var input = $('#text')[0];
			input.value = input.value.replace(/.$/, '');
		}

		function clearText() {
			falar("Limpar");
			$("#text").val("");
		}

		function space() {
			falar("Espaço");
			$("#text").val($("#text").val() + " ");
		}

		function speakLoud () {
			falar($("#text").val());
		}

		function speedRatio () {
			return Math.trunc((1 - (interval - minInterval) / (maxInterval - minInterval)) * 100);
		}

		function alternarScan(grupo) {
			if (scan.isScanning()){
				falar("Varredura desabilitada");
				scan.stop();
			} else {
				falar("Varredura habilitada");
				scan.start(grupo);
			}
		}
		
		function mostrarToast(msg) {
			var toast = document.getElementById("toast-speed");
			var toastMsg = toast.getElementsByClassName("toast-msg")[0];
			toastMsg.innerHTML = msg;
			toast.style.display = "block";
			setTimeout(function () {
				toast.style.display = "none";
				toastMsg.innerHTML = "";
			}, 2500);
		}

		function mudarVelocidade(interval) {
			scan.changeIntervalTime(interval);
			localStorage.setItem(storageSpeedKey, interval);
			var msg = "Velocidade em " + speedRatio() + "%";
			falar(msg);
			mostrarToast(msg);
		}

		function aumentarVelocidade() {
			interval = interval - 250;
			if (interval <= 500) interval = 500;
			mudarVelocidade(interval);
		}

		function diminuirVelocidade() {
			interval = interval + 250;
			if (interval >= 5000) interval = 5000;
			mudarVelocidade(interval);
		}

    	function trocaTeclado() {
			var mainCol = $("div.main-col");
			if ($("div.main-col").hasClass("set-letters")) {
				var fala = new SpeechSynthesisUtterance("Teclado numérico");
             	window.speechSynthesis.speak(fala);
				$("div.main-col").removeClass("set-letters").addClass("set-digits");
				$('[data-in-groups="controls"][data-next-group]').attr("data-next-group", "group-2");
				$('[data-in-groups="specials"][data-next-group]').attr("data-next-group", "group-2");
				$("#alternar-scan")[0].onclick = function () { alternarScan("group-2") };
				$("#botaoTrocaTeclado span")[0].innerHTML = "ABC";
				if (scan.isScanning()) scan.reset("group-2");
			} else {
				var fala = new SpeechSynthesisUtterance("Teclado alfabético");
             	window.speechSynthesis.speak(fala);
				$("div.main-col").removeClass("set-digits").addClass("set-letters");
				$('[data-in-groups="controls"][data-next-group]').attr("data-next-group", "group-1");
				$('[data-in-groups="specials"][data-next-group]').attr("data-next-group", "group-1");
				$("#alternar-scan")[0].onclick =function () { alternarScan("group-1") };
				$("#botaoTrocaTeclado span")[0].innerHTML = "123";
				if (scan.isScanning()) scan.reset("group-1");
			}
    	};

		$(document).ready(function(){			
			var layout = Layout();
			var mediaPortrait = window.matchMedia("(orientation:portrait)");
			var mediaLandscape = window.matchMedia("(orientation:landscape)");
			mediaPortrait.addListener(function (m) {
				if (m.matches) {
					layout.buildLayoutForSmallScreen(".main-col");
				} 
			});
			mediaLandscape.addListener(function (m) {
				if (m.matches) {
					layout.buildLayoutForBigScreen(".main-col");
				} 
			});
			if (mediaPortrait.matches) {
				layout.buildLayoutForSmallScreen(".main-col");
			} else {
				layout.buildLayoutForBigScreen(".main-col");
			}

			scan = createScan({
				interval: interval,
				goBack: 3
			});

			$(document).on("keydown", function (ev) {
				if (ev.keyCode == 27) { //esc
					if (scan.isScanning()) {
						falar("Varredura desabilitada");
						scan.stop();
					}
				}
			});
			
    	});
	</script>

</head>
<body>
	<div class="container-fluid">
		<div class="menu row" >
			<div class="col-12 w-100 h-100">
				Nav Menu
			</div>
		</div>
		<div class="main row">
			<div class="main-col set-letters col-12"></div>
		</div>
	</div>
	<div id="toast-speed" class="toast-box">
		<p class="toast-msg">
		</p>
	</div>	
</body>
</html>